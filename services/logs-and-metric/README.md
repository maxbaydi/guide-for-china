# üöÄ –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Promtail-Prometheus-Loki-Grafana –¥–ª—è Guide for China

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Guide for China, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫ –∏–∑ –≤—Å–µ—Ö NestJS —Å–µ—Ä–≤–∏—Å–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç](#-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-–≤-–ø—Ä–æ–µ–∫—Ç)
- [–°–µ—Ä–≤–∏—Å—ã –ø—Ä–æ–µ–∫—Ç–∞](#-—Å–µ—Ä–≤–∏—Å—ã-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
- [Troubleshooting](#-troubleshooting)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É monitoring –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
cp -r /path/to/logs-and-metric ./monitoring
cd monitoring

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É
./scripts/setup.sh
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º

–î–æ–±–∞–≤—å—Ç–µ labels –∫ –≤–∞—à–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º –≤ `docker-compose.yml`:

```yaml
services:
  my-app:
    image: my-app:latest
    labels:
      logging: enabled          # –í–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä –ª–æ–≥–æ–≤
      logging.service: my-app   # –ò–º—è —Å–µ—Ä–≤–∏—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      monitoring: enabled       # –í–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
      monitoring.port: "8080"   # –ü–æ—Ä—Ç –¥–ª—è –º–µ—Ç—Ä–∏–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

```bash
docker-compose up -d
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤
./scripts/test-logs.sh

# –û—Ç–∫—Ä–æ–π—Ç–µ Grafana: http://localhost:3000 (admin/admin)
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –í–∞—à–∏          ‚îÇ    ‚îÇ   Promtail      ‚îÇ    ‚îÇ   Loki          ‚îÇ
‚îÇ   –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   (—Å–±–æ—Ä –ª–æ–≥–æ–≤)  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   (—Ö—Ä–∞–Ω–µ–Ω–∏–µ)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ   Prometheus    ‚îÇ    ‚îÇ   Grafana      ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ   (–º–µ—Ç—Ä–∏–∫–∏)     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **Promtail**: –°–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ –∏–∑ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- **Loki**: –•—Ä–∞–Ω–∏—Ç –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –ª–æ–≥–∏
- **Prometheus**: –°–æ–±–∏—Ä–∞–µ—Ç –∏ —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç—Ä–∏–∫–∏
- **Grafana**: –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

#### Production (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```bash
docker-compose up -d
```

#### Development
```bash
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ .env

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:

```bash
cp .env.example .env
nano .env
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Guide for China —á–µ—Ä–µ–∑ `docker-compose.prod.yml`.

### –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤–∫–ª—é—á–∞—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
docker-compose -f docker-compose.prod.yml up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker-compose -f docker-compose.prod.yml ps | grep -E "(promtail|loki|prometheus|grafana)"
```

### –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- **Grafana**: https://mypns.com:3000 (admin/admin123)
- **Prometheus**: http://server-ip:9090
- **Loki**: http://server-ip:3100
- **Promtail**: http://server-ip:9080

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: 
- Grafana –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω —Å HTTPS
- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ IP —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–∫—Ä—ã—Ç—å –∏—Ö —á–µ—Ä–µ–∑ firewall –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å port-forwarding –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
- –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `GRAFANA_DOMAIN` –≤ —Ñ–∞–π–ª–µ `services/logs-and-metric/.env`

## üèóÔ∏è –°–µ—Ä–≤–∏—Å—ã –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç Guide for China –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º:

### API Gateway (–ø–æ—Ä—Ç 4000)
- **–ú–µ—Ç—Ä–∏–∫–∏**: `api_gateway_*`
- **–õ–æ–≥–∏**: `logging.service=api-gateway`
- **Endpoint –º–µ—Ç—Ä–∏–∫**: `/metrics`

### Dictionary Service (–ø–æ—Ä—Ç 4001)
- **–ú–µ—Ç—Ä–∏–∫–∏**: `dictionary_service_*`
- **–õ–æ–≥–∏**: `logging.service=dictionary-service`
- **Endpoint –º–µ—Ç—Ä–∏–∫**: `/metrics`

### User Service (–ø–æ—Ä—Ç 4002)
- **–ú–µ—Ç—Ä–∏–∫–∏**: `user_service_*`
- **–õ–æ–≥–∏**: `logging.service=user-service`
- **Endpoint –º–µ—Ç—Ä–∏–∫**: `/metrics`

### TTS Service (–ø–æ—Ä—Ç 4003)
- **–ú–µ—Ç—Ä–∏–∫–∏**: `tts_service_*`
- **–õ–æ–≥–∏**: `logging.service=tts-service`
- **Endpoint –º–µ—Ç—Ä–∏–∫**: `/metrics`

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- **PostgreSQL**: –õ–æ–≥–∏ –≤–∫–ª—é—á–µ–Ω—ã
- **Redis**: –õ–æ–≥–∏ –≤–∫–ª—é—á–µ–Ω—ã
- **MinIO**: –õ–æ–≥–∏ –≤–∫–ª—é—á–µ–Ω—ã
- **Nginx**: –õ–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Guide for China)

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–æ–µ–∫—Ç–∞ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞. –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ endpoint `/metrics` –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫ –≤ Prometheus

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ API Gateway
curl http://localhost:4000/metrics

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ Dictionary Service
curl http://localhost:4001/metrics

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ User Service
curl http://localhost:4002/metrics

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ TTS Service
curl http://localhost:4003/metrics
```

#### –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã Prometheus

```promql
# –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≤—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º
sum(nestjs_http_requests_total)

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
sum by (app_name) (nestjs_http_requests_total)

# –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
histogram_quantile(0.95, sum(rate(nestjs_http_request_duration_seconds_bucket[5m])) by (le, app_name))

# –û—à–∏–±–∫–∏ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
sum by (app_name) (nestjs_http_requests_total{status_code=~"5.."})

# –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
sum(nestjs_http_requests_in_progress)
```

#### –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã Loki (–ª–æ–≥–∏)

```logql
# –í—Å–µ –ª–æ–≥–∏ –æ—Ç API Gateway
{service="api-gateway"}

# –û—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
{level="ERROR"} |= "error"

# –õ–æ–≥–∏ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
{container_name=~"guide-.*"} |= "database connection"

# –õ–æ–≥–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —É—Ä–æ–≤–Ω—é
{service="api-gateway"} | json | level="INFO"

# –õ–æ–≥–∏ GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤
{service="dictionary-service"} |= "GraphQL"

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `.env`):

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| `GRAFANA_PORT` | 3000 | –ü–æ—Ä—Ç Grafana |
| `PROMETHEUS_PORT` | 9090 | –ü–æ—Ä—Ç Prometheus |
| `LOKI_PORT` | 3100 | –ü–æ—Ä—Ç Loki |
| `GRAFANA_ADMIN_USER` | admin | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Grafana |
| `GRAFANA_ADMIN_PASSWORD` | admin123 | –ü–∞—Ä–æ–ª—å Grafana |
| `LOKI_RETENTION_PERIOD` | 720h | –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ (30 –¥–Ω–µ–π) |
| `PROMETHEUS_RETENTION_TIME` | 30d | –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ (30 –¥–Ω–µ–π) |
| `ENVIRONMENT` | prod | –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã |
| `PROMETHEUS_SCRAPE_INTERVAL` | 15s | –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ |
| `PROMETHEUS_SCRAPE_TIMEOUT` | 10s | –¢–∞–π–º–∞—É—Ç –¥–ª—è scrape –æ–ø–µ—Ä–∞—Ü–∏–π |

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤ —Ñ–∞–π–ª–µ `services/logs-and-metric/.env`.

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏ –Ω–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ labels –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
   ```bash
   docker inspect guide-api-gateway | grep -A 10 Labels
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Promtail:
   ```bash
   docker logs guide-promtail
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Loki:
   ```bash
   curl http://localhost:3100/ready
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Prometheus

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –º–µ—Ç—Ä–∏–∫–∏:
   ```bash
   curl http://localhost:4000/metrics
   curl http://localhost:4001/metrics
   curl http://localhost:4002/metrics
   curl http://localhost:4003/metrics
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Prometheus:
   ```bash
   curl http://localhost:9090/api/v1/targets
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ labels `monitoring=enabled` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: Grafana –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ –¥–∞–Ω–Ω—ã—Ö:
   ```bash
   sudo chown -R 472:472 grafana_data/
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Grafana:
   ```bash
   docker logs guide-grafana
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å—ã –Ω–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏:
   ```bash
   docker network ls | grep guide-network
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏:
   ```bash
   docker inspect guide-api-gateway | grep NetworkMode
   ```

## üìà –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker-compose -f docker-compose.prod.yml ps | grep -E "(promtail|loki|prometheus|grafana)"

# –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker logs guide-promtail
docker logs guide-loki
docker logs guide-prometheus
docker logs guide-grafana

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats guide-promtail guide-loki guide-prometheus guide-grafana
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
for port in 4000 4001 4002 4003; do
  echo "=== Service on port $port ==="
  curl -s http://localhost:$port/metrics | head -10
done
```

### –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker-compose -f docker-compose.prod.yml stop promtail loki prometheus grafana

# –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–û–°–¢–û–†–û–ñ–ù–û!)
docker volume rm guide-for-china_grafana_data guide-for-china_prometheus_data guide-for-china_loki_data

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose -f docker-compose.prod.yml up -d promtail loki prometheus grafana
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Loki](https://grafana.com/docs/loki/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Prometheus](https://prometheus.io/docs/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Grafana](https://grafana.com/docs/)
- [NestJS Prometheus Integration](https://github.com/willsoto/nestjs-prometheus)

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [Troubleshooting](#-troubleshooting)
2. –ò–∑—É—á–∏—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤: `docker logs <service_name>`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `services/logs-and-metric/.env`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–æ—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã: `docker-compose -f docker-compose.prod.yml ps`

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –≤ –≤–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.