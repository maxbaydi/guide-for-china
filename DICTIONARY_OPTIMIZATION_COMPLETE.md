# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤ - –ó–∞–≤–µ—Ä—à–µ–Ω–∞ ‚úÖ

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Ä–µ—à–µ–Ω—ã

1. ‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –¥–æ 20 —ç–ª–µ–º–µ–Ω—Ç–æ–≤**
   - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ—Ç–∞–ª–µ–π –∏–µ—Ä–æ–≥–ª–∏—Ñ–∞ —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–∞–∫—Å–∏–º—É–º 20 –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –∏ 20 –ø—Ä–∏–º–µ—Ä–æ–≤
   - –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É –∏ —É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É

2. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ "–∏–µ—Ä–æ–≥–ª–∏—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω"**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP 404 —Å—Ç–∞—Ç—É—Å
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

3. ‚úÖ **–£–ª—É—á—à–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ "—Å–ª–æ–≤–∞ –¥–Ω—è"**
   - –£–ª—É—á—à–µ–Ω–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ (—á–µ—Ä–Ω—ã–π –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤)
   - –î–æ–±–∞–≤–ª–µ–Ω –Ω–∞–¥–µ–∂–Ω—ã–π fallback –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - –¢–µ–∫—Å—Ç —Ö–æ—Ä–æ—à–æ —á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞ —Ä–æ–∑–æ–≤–æ–º —Ñ–æ–Ω–µ –∫–∞—Ä—Ç–æ—á–∫–∏

4. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–º–µ—Ä–æ–≤**
   - –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å LIMIT
   - –í—Å–µ –ø—Ä–∏–º–µ—Ä—ã —Ç–µ–ø–µ—Ä—å —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ

5. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç —Å—Ç–∞—Ä—ã—Ö –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–µ—à–∞
   - –î–∞–∂–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ–±—Ä–µ–∑–∞–Ω—ã –¥–æ 20 —ç–ª–µ–º–µ–Ω—Ç–æ–≤

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend
- `services/dictionary/src/services/dictionary.service.ts` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `services/api-gateway/src/dictionary/dictionary.controller.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- `infrastructure/postgres/migrations/006_optimize_examples_query.sql` - –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤

### Mobile
- `mobile/app/(tabs)/search.tsx` - —É–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏ "—Å–ª–æ–≤–∞ –¥–Ω—è"

### –°–∫—Ä–∏–ø—Ç—ã
- `infrastructure/scripts/clear-redis-cache.sh` - —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞

## –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å–æ–≤
cd infrastructure/scripts
chmod +x apply-performance-migrations.sh
./apply-performance-migrations.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
psql -U postgres -d chinese_guide -f infrastructure/postgres/migrations/006_optimize_examples_query.sql
```

### 2. –û—á–∏—Å—Ç–∏—Ç—å Redis –∫–µ—à

**–í–ê–ñ–ù–û:** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.

```bash
cd infrastructure/scripts
chmod +x clear-redis-cache.sh
./clear-redis-cache.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ redis-cli:
```bash
redis-cli
> KEYS character:*
> DEL character:key1 character:key2 ... (–∏–ª–∏ FLUSHDB –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏)
> KEYS search:*
> DEL search:key1 search:key2 ...
> KEYS analysis:*
> DEL analysis:key1 analysis:key2 ...
> KEYS word-of-day:*
> DEL word-of-day:key1 ...
> exit
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ docker-compose
docker-compose restart dictionary user api-gateway

# –ò–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–¥–µ–ª—å–Ω–æ
cd services/dictionary && npm run start:dev
cd services/api-gateway && npm run start:dev
cd services/user && npm run start:dev
```

### 4. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
cd mobile
npm install
# –î–ª—è Android
npx expo start --clear
# –ò–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
npx expo prebuild --clean
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚ö° **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏**: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π –∏–µ—Ä–æ–≥–ª–∏—Ñ–∞ –≤ 3-5 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ
- ‚ö° **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è RAM –Ω–∞ 60-80%
- ‚ö° **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î**: –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–æ —Å–µ—Ç–∏

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- üõ°Ô∏è **–ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π**: –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–∏–º–µ—Ä–æ–≤
- üõ°Ô∏è **–ù–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- üõ°Ô∏è **–ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏**: –í–º–µ—Å—Ç–æ "—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

### UX
- üëÅÔ∏è **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: "–°–ª–æ–≤–æ –¥–Ω—è" —Ç–µ–ø–µ—Ä—å —Ö–æ—Ä–æ—à–æ —á–∏—Ç–∞–µ—Ç—Å—è
- üëÅÔ∏è **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ –∏–µ—Ä–æ–≥–ª–∏—Ñ—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ –±—ã—Å—Ç—Ä–æ
- üëÅÔ∏è **Feedback**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–µ `examples` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
```typescript
examples: {
  take: 20,
  orderBy: {
    createdAt: 'desc',
  },
}
```

### –ò–Ω–¥–µ–∫—Å –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```sql
CREATE INDEX idx_examples_character_id_created 
ON examples ("characterId", "createdAt" DESC);
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ dictionary.service:
- `Character found: ${simplified} (${id})` - –∏–µ—Ä–æ–≥–ª–∏—Ñ –Ω–∞–π–¥–µ–Ω
- `Character not found with id: ${id}` - –∏–µ—Ä–æ–≥–ª–∏—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω
- Cache hit/miss –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–ª–µ–¥–∏—Ç–µ –∑–∞:
1. **–õ–æ–≥–∞–º–∏ dictionary service** - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö/–Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∏–µ—Ä–æ–≥–ª–∏—Ñ–∞—Ö
2. **–í—Ä–µ–º–µ–Ω–µ–º –æ—Ç–∫–ª–∏–∫–∞ API** - –¥–æ–ª–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å—Å—è —Å ~500ms –¥–æ ~100-150ms
3. **–†–∞–∑–º–µ—Ä–æ–º –∫–µ—à–∞ Redis** - –¥–æ–ª–∂–µ–Ω —É–º–µ–Ω—å—à–∏—Ç—å—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 2-3 —Ä–∞–∑–∞

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# 1. –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Git
git checkout HEAD~1 services/dictionary/src/services/dictionary.service.ts
git checkout HEAD~1 services/api-gateway/src/dictionary/dictionary.controller.ts
git checkout HEAD~1 mobile/app/(tabs)/search.tsx

# 2. –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
DROP INDEX IF EXISTS idx_examples_character_id_created;

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker-compose restart
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—á–∏—â–∞—Ç—å Redis –∫–µ—à —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ –∫–µ—à–∞**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å alerts –Ω–∞ —Ä–∞–∑–º–µ—Ä Redis
3. **–ò–Ω–¥–µ–∫—Å—ã**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (`ANALYZE` –≤—ã–ø–æ–ª–Ω–µ–Ω)

---

**–î–∞—Ç–∞**: $(date +%Y-%m-%d)
**–í–µ—Ä—Å–∏—è**: 1.0.0
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

