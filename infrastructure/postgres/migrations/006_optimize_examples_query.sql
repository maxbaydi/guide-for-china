-- Миграция для оптимизации запросов примеров с LIMIT
-- Цель: ускорить загрузку ограниченного количества примеров

-- ============================================
-- Индекс для быстрого получения первых N примеров
-- ============================================

-- Улучшенный композитный индекс для examples с оптимизацией LIMIT
-- Включает createdAt для детерминированного порядка
CREATE INDEX IF NOT EXISTS idx_examples_character_id_created 
ON examples ("characterId", "createdAt" DESC);

-- Удаляем старый индекс если он конфликтует
DROP INDEX IF EXISTS idx_examples_character_created;

-- ============================================
-- Статистика для планировщика
-- ============================================

ANALYZE examples;

-- Комментарий
COMMENT ON INDEX idx_examples_character_id_created IS 'Композитный индекс для быстрого получения первых N примеров по иероглифу';

