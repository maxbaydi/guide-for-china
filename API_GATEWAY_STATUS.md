# API Gateway - ะขะตะบััะธะน ััะฐััั

## โ ะงัะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ

### 1. ะะฐะทะพะฒะฐั ััััะบัััะฐ API Gateway
- โ NestJS ะฟัะพะตะบั ัะพะทะดะฐะฝ
- โ ะะฐะฒะธัะธะผะพััะธ ัััะฐะฝะพะฒะปะตะฝั
- โ ะะพะฝัะธะณััะฐัะธั ัะตัะตะท `.env`
- โ ะกะฑะพัะบะฐ ะฟัะพะตะบัะฐ ััะฟะตัะฝะฐ

### 2. ะะฝัะตะณัะฐัะธั Redis
- โ RedisModule ัะพะทะดะฐะฝ
- โ RedisService ั ะผะตัะพะดะฐะผะธ get/set/del/incr
- โ ะะพะดะบะปััะตะฝะธะต ะบ Redis ะฝะฐ localhost:6379
- โ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะฟะพะดะบะปััะตะฝะธั

### 3. Rate Limiting
- โ @nestjs/throttler ะธะฝัะตะณัะธัะพะฒะฐะฝ
- โ CustomThrottlerGuard ั ะฟะพะดะดะตัะถะบะพะน userId
- โ ะะฐัััะพะนะบะธ ัะตัะตะท environment variables

### 4. Health Check
- โ `/health` endpoint
- โ ะะฐะทะพะฒัะน ะบะพะฝััะพะปะปะตั

## โ๏ธ ะงัะพ ะฝัะถะฝะพ ะดะพัะฐะฑะพัะฐัั

### Apollo Federation
**ะัะพะฑะปะตะผะฐ:** Dictionary Service ะฝะต ะฝะฐัััะพะตะฝ ะบะฐะบ Apollo Federation subgraph, ะฟะพััะพะผั Apollo Gateway ะฝะต ะผะพะถะตั ะตะณะพ ะฟะพะดะบะปััะธัั.

**ะะตัะตะฝะธะต (ะฝะฐ ะฒัะฑะพั):**

#### ะะฐัะธะฐะฝั 1: ะัะพััะพะน HTTP ะฟัะพะบัะธ (ัะตะบะพะผะตะฝะดัะตััั ะดะปั MVP)
ะกะพะทะดะฐัั ะฟัะพัััะต resolver'ั ะฒ API Gateway, ะบะพัะพััะต ะดะตะปะฐัั HTTP ะทะฐะฟัะพัั ะบ Dictionary Service:

```typescript
@Resolver()
export class DictionaryProxyResolver {
  async searchCharacters(query: string) {
    const response = await axios.post('http://localhost:3001/graphql', {
      query: `query { searchCharacters(query: "${query}") { ... } }`
    });
    return response.data.data.searchCharacters;
  }
}
```

#### ะะฐัะธะฐะฝั 2: Apollo Federation (ะดะปั production)
1. ะะพะฑะฐะฒะธัั `@apollo/subgraph` ะฒ Dictionary Service
2. ะะพะฑะฐะฒะธัั Federation ะดะธัะตะบัะธะฒั ะบ GraphQL ััะตะผะต
3. ะะฐัััะพะธัั Apollo Gateway ะฟัะฐะฒะธะปัะฝะพ

## ๐ ะขะตะบััะฐั ะฐััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ  Mobile App     โ
โ (React Native)  โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โ HTTP/GraphQL
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  API Gateway    โ  โ ะะพัั 3000
โ  (NestJS)       โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โ (ะฟะพะบะฐ ะฝะฐะฟััะผัั)
         โผ
โโโโโโโโโโโโโโโโโโโ
โ Dictionary      โ  โ ะะพัั 3001
โ Service         โ
โ (NestJS)        โ
โโโโโโโโโโโโโโโโโโโ
```

## ๐ ะกะปะตะดัััะธะต ัะฐะณะธ

### ะะตะผะตะดะปะตะฝะฝัะต (ะดะปั MVP):
1. **ะะตัะธัั ะฒะพะฟัะพั ั Gateway:**
   - ะัะฟะพะปัะทะพะฒะฐัั Dictionary Service ะฝะฐะฟััะผัั ะฝะฐ ะฟะพััั 3001
   - ะะปะธ ัะพะทะดะฐัั ะฟัะพัััะต ะฟัะพะบัะธ-ัะตะทะพะปะฒะตัั ะฒ API Gateway

### ะกัะตะดะฝะธะน ััะพะบ:
2. **ะะฐัััะพะธัั Apollo Federation** (ะบะพะณะดะฐ ะฑัะดัั ะณะพัะพะฒั User ะธ Subscription ัะตัะฒะธัั)
3. **ะะพะฑะฐะฒะธัั ะบััะธัะพะฒะฐะฝะธะต** ะฟะพะฟัะปััะฝัั ะทะฐะฟัะพัะพะฒ ัะตัะตะท Redis
4. **ะะพะฑะฐะฒะธัั JWT middleware** ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ

### ะะพะปะณะพััะพัะฝัะต:
5. **ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต**
6. **Metrics ะธ tracing**
7. **GraphQL persisted queries**

## ๐ก ะะตะบะพะผะตะฝะดะฐัะธั

**ะะปั ัะตะบััะตะณะพ MVP ะฟัะตะดะปะฐะณะฐั:**
- ะััะฐะฒะธัั Dictionary Service ะดะพัััะฟะฝัะผ ะฝะฐะฟััะผัั ะฝะฐ ะฟะพััั 3001
- API Gateway ะธัะฟะพะปัะทะพะฒะฐัั ัะพะปัะบะพ ะดะปั:
  - Rate limiting
  - ะััะตะฝัะธัะธะบะฐัะธะธ (ะบะพะณะดะฐ ะฟะพัะฒะธััั User Service)
  - ะััะธัะพะฒะฐะฝะธั
- ะะพะทะถะต, ะบะพะณะดะฐ ะฟะพัะฒัััั User ะธ Subscription ัะตัะฒะธัั, ะฝะฐัััะพะธัั ะฟะพะปะฝะพัะตะฝะฝัะน Apollo Federation

ะญัะพ ะฟะพะทะฒะพะปะธั ะฝะฐะผ ะฑััััะพ ะดะฒะธะณะฐัััั ะฒะฟะตัะตะด ะธ ะฝะต ะทะฐัััะตะฒะฐัั ะฝะฐ ะฝะฐัััะพะนะบะต Federation ะดะปั ะพะดะฝะพะณะพ ัะตัะฒะธัะฐ.

## ๐ ะขะตะบััะธะต ัะตัะฒะธัั

| ะกะตัะฒะธั | ะะพัั | ะกัะฐััั | GraphQL Playground |
|--------|------|--------|-------------------|
| Dictionary Service | 3001 | โ ะะฐะฑะพัะฐะตั | http://localhost:3001/graphql |
| API Gateway | 3000 | โ๏ธ ะขัะตะฑัะตั ะดะพัะฐะฑะพัะบะธ | - |
| PostgreSQL | 5432 | โ ะะฐะฑะพัะฐะตั | - |
| Redis | 6379 | โ ะะฐะฑะพัะฐะตั | - |

## ๐ฏ ะงัะพ ัะฐะฑะพัะฐะตั ะฟััะผะพ ัะตะนัะฐั

**Dictionary Service (http://localhost:3001/graphql):**
- โ `searchCharacters(query, limit)` 
- โ `getCharacter(id)`
- โ `getCharacterBySimplified(simplified)`
- โ `searchPhrases(query, limit)`
- โ `analyzeText(text)`

**ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ:**
```graphql
# ะะพะปััะธัั ะธะตัะพะณะปะธั
{
  getCharacterBySimplified(simplified: "ไฝ") {
    simplified
    pinyin
    definitions {
      translation
    }
  }
}

# ะะฐะทะพะฑัะฐัั ัะตะบัั
{
  analyzeText(text: "ๆๅญฆไนไธญๆ") {
    character
    position
    details {
      simplified
      pinyin
      definitions {
        translation
      }
    }
  }
}
```

